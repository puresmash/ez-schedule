
<script src="https://www.gstatic.com/firebasejs/3.3.0/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyDs_7lHc8nQCzMDfNINRFllD9krPlD6XNk",
    authDomain: "swat101-19e2d.firebaseapp.com",
    databaseURL: "https://swat101-19e2d.firebaseio.com",
    storageBucket: "",
  };
  firebase.initializeApp(config);
</script>
<script>
  function login(){
      var provider = new firebase.auth.GoogleAuthProvider();
      //firebase.auth().signInWithRedirect(provider);
      firebase.auth().signInWithPopup(provider).then(function(result) {
          // This gives you a Google Access Token. You can use it to access the Google API.
          var token = result.credential.accessToken;
          // The signed-in user info.
          var user = result.user;
          // P.S. result.user == firebase.auth().currentUser (firebase do inject for us?)
          // So we can get uid in this way.
          var userId = firebase.auth().currentUser.uid;
          var avatar = firebase.auth().currentUser.photoURL;
          var email = firebase.auth().currentUser.email;
          var displayName = firebase.auth().currentUser.displayName;
          console.log(`userId: ${userId}`);
          console.log(`avatar: ${avatar}`);
          console.log(`email: ${email}`);
          console.log(`displayName: ${displayName}`);

          return userId;
      })
      .then((userId)=>{
          getUserDetails(userId);
      })
      .catch(function(error) {
          // Handle Errors here.
          var errorCode = error.code;
          var errorMessage = error.message;
          // The email of the user's account used.
          var email = error.email;
          // The firebase.auth.AuthCredential type that was used.
          var credential = error.credential;
          // ...
      });
  }
  function getUserDetails(userId){
      // var userId = firebase.auth().currentUser.uid;
      console.log(`userId:${userId} is entering for retrieving data from db`);

      return firebase.database().ref('/users/'+userId).once('value').then(
        (snapshot) => {
          console.log(snapshot.val());
        }
      )
      .catch((err)=>{
          console.log(`FAIL MSG: ${err}`);
          // TODO: Do something to inform user IF you want
      });
  }
  login();
  // var newPostKey = firebase.database().ref().child('posts').push().key;
  // var updates = {};
  // updates['/posts/' + newPostKey] = postData;
  // updates['/user-posts/' + uid + '/' + newPostKey] = postData;
  // return firebase.database().ref().update(updates);
</script>
